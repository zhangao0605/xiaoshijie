var ctx="$InfiniteScroll$",throttle=function(t,e){var n,i,o,r,l,c=function(){t.apply(r,l),i=n};return function(){if(r=this,l=arguments,n=Date.now(),o&&(clearTimeout(o),o=null),i){var t=e-(n-i);0>t?c():o=setTimeout(function(){c()},t)}else c()}},getScrollTop=function(t){return t===window?Math.max(window.pageYOffset||0,document.documentElement.scrollTop):t.scrollTop},getScrollEventTarget=function(t){for(var e=document.defaultView.getComputedStyle,n=t;n&&"HTML"!==n.tagName&&"BODY"!==n.tagName&&1===n.nodeType;){var i=e(n).overflowY;if("scroll"===i||"auto"===i)return n;n=n.parentNode}return window},getVisibleHeight=function(t){return t===window?document.documentElement.clientHeight:t.clientHeight},getElementTop=function(t){return t===window?getScrollTop(window):t.getBoundingClientRect().top+getScrollTop(window)},isAttached=function(t){for(var e=t.parentNode;e;){if("HTML"===e.tagName)return!0;if(11===e.nodeType)return!1;e=e.parentNode}return!1},doBind=function(){if(!this.binded){this.binded=!0;var t=this,e=t.el;t.scrollEventTarget=getScrollEventTarget(e),t.scrollListener=throttle(doCheck.bind(t),250),t.scrollEventTarget.addEventListener("scroll",t.scrollListener);var n=e.getAttribute("infinite-scroll-disabled"),i=!1;n&&(this.vm.$watch(n,function(e){t.disabled=e,!e&&t.immediateCheck&&doCheck.call(t)}),i=Boolean(t.vm[n])),t.disabled=i;var o=e.getAttribute("infinite-scroll-distance"),r=0;o&&(r=Number(t.vm[o]||o),isNaN(r)&&(r=0)),t.distance=r;var l=e.getAttribute("infinite-scroll-immediate-check"),c=!0;l&&(c=Boolean(t.vm[l])),t.immediateCheck=c,c&&doCheck.call(t);var a=e.getAttribute("infinite-scroll-listen-for-event");a&&t.vm.$on(a,function(){doCheck.call(t)})}},doCheck=function(t){var e=this.scrollEventTarget,n=this.el,i=this.distance;if(t===!0||!this.disabled){var o=getScrollTop(e),r=o+getVisibleHeight(e),l=!1;if(e===n)l=e.scrollHeight-r<=i;else{var c=getElementTop(n)-getElementTop(e)+n.offsetHeight+o;l=r+i>=c}l&&this.expression&&this.expression()}},InfiniteScroll={bind:function(t,e,n){t[ctx]={el:t,vm:n.context,expression:e.value};var i=arguments;t[ctx].vm.$on("hook:mounted",function(){t[ctx].vm.$nextTick(function(){isAttached(t)&&doBind.call(t[ctx],i),t[ctx].bindTryCount=0;var e=function(){t[ctx].bindTryCount>10||(t[ctx].bindTryCount++,isAttached(t)?doBind.call(t[ctx],i):setTimeout(e,50))};e()})})},unbind:function(t){t[ctx].scrollEventTarget.removeEventListener("scroll",t[ctx].scrollListener)}};Vue.directive("InfiniteScroll",InfiniteScroll);